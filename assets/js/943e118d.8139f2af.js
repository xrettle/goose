"use strict";(self.webpackChunkgoose=self.webpackChunkgoose||[]).push([[6226],{51562:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>o,contentTitle:()=>a,default:()=>h,frontMatter:()=>l,metadata:()=>i,toc:()=>d});var i=s(36991),t=s(74848),r=s(28453);const l={title:"Streamlining Detection Development with Goose Recipes",description:"A comprehensive guide to using recipes in Goose to streamline security detection development",authors:["glenn"]},a=void 0,o={authorsImageUrls:[void 0]},d=[{value:"What Are Recipes?",id:"what-are-recipes",level:2},{value:"What about .goosehints?",id:"what-about-goosehints",level:3},{value:"The Architecture",id:"the-architecture",level:2},{value:"Design Principles",id:"design-principles",level:3},{value:"Why Sub-Recipes Matter",id:"why-sub-recipes-matter",level:3},{value:"Data Flow and State Management",id:"data-flow-and-state-management",level:2},{value:"Smart Optimizations: Conditional Execution",id:"smart-optimizations-conditional-execution",level:2},{value:"Parameter-Based Conditions",id:"parameter-based-conditions",level:3},{value:"Runtime Conditions",id:"runtime-conditions",level:3},{value:"Deep Dive: Key Sub-Recipes",id:"deep-dive-key-sub-recipes",level:2},{value:"1. <code>workflow_setup</code>: Foundation First",id:"1-workflow_setup-foundation-first",level:3},{value:"2. <code>similar_rule_analyzer</code>: Learning from Existing Patterns",id:"2-similar_rule_analyzer-learning-from-existing-patterns",level:3},{value:"3. <code>schema_and_sample_events_analyzer</code>: Data-Driven Detection Logic",id:"3-schema_and_sample_events_analyzer-data-driven-detection-logic",level:3},{value:"4. <code>rule_creator</code>: The Implementation Engine",id:"4-rule_creator-the-implementation-engine",level:3},{value:"5. <code>testing_validator</code>: Quality Assurance",id:"5-testing_validator-quality-assurance",level:3},{value:"6. <code>pr_creator</code>: Automated Pull Request Pipeline",id:"6-pr_creator-automated-pull-request-pipeline",level:3},{value:"Error Handling and Fail-Fast Design",id:"error-handling-and-fail-fast-design",level:2},{value:"Standardized Response Schema",id:"standardized-response-schema",level:3},{value:"Failures",id:"failures",level:3},{value:"Practical Usage Examples",id:"practical-usage-examples",level:2},{value:"Basic Usage: Fast Detection Creation",id:"basic-usage-fast-detection-creation",level:3},{value:"Comprehensive Analysis Mode",id:"comprehensive-analysis-mode",level:3},{value:"Standards Compliance and Quality Assurance",id:"standards-compliance-and-quality-assurance",level:2},{value:"Automated Standards Extraction",id:"automated-standards-extraction",level:3},{value:"Built-in Quality Checks",id:"built-in-quality-checks",level:3},{value:"Pull Request Automation",id:"pull-request-automation",level:3},{value:"Panther MCP Integration",id:"panther-mcp-integration",level:3},{value:"Benefits and Impact",id:"benefits-and-impact",level:2},{value:"Conclusion",id:"conclusion",level:2},{value:"Best Practices and Lessons Learned",id:"best-practices-and-lessons-learned",level:2},{value:"Instruction Formatting &amp; Clarity",id:"instruction-formatting--clarity",level:4},{value:"Structure &amp; Logic in Prompts",id:"structure--logic-in-prompts",level:4},{value:"Validation &amp; Guardrails",id:"validation--guardrails",level:4},{value:"Knowledge Sharing &amp; Context Management",id:"knowledge-sharing--context-management",level:4},{value:"Workflow Design",id:"workflow-design",level:4}];function c(e){const n={a:"a",blockquote:"blockquote",code:"code",em:"em",h2:"h2",h3:"h3",h4:"h4",hr:"hr",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.R)(),...e.components},{Details:i,Head:l}=n;return i||u("Details",!0),l||u("Head",!0),(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{alt:"blog cover",src:s(57977).A+"",width:"1536",height:"1024"})}),"\n",(0,t.jsx)(n.p,{children:"Creating effective security detections in Panther traditionally requires deep knowledge of detection logic, testing frameworks, and development workflows. The detection engineering team at Block has streamlined this process by building Goose recipes that automate the entire detection creation lifecycle from initial repository setup to pull request creation."}),"\n",(0,t.jsxs)(n.p,{children:["This blog post explores how to leverage Goose's ",(0,t.jsx)(n.a,{href:"https://block.github.io/goose/docs/guides/recipes/",children:"recipe"})," and ",(0,t.jsx)(n.a,{href:"https://block.github.io/goose/docs/guides/recipes/sub-recipes",children:"sub-recipe"})," system to create new detections in Panther with minimal manual intervention, ensuring consistency, quality, and adherence to team standards."]}),"\n",(0,t.jsx)(n.h2,{id:"what-are-recipes",children:"What Are Recipes?"}),"\n",(0,t.jsx)(n.p,{children:"Recipes are reusable, shareable configurations that package up a complete setup for a specific task. These standalone files can be used in automation workflows that orchestrate complex tasks by breaking them into manageable, specialized components. Think of them as sophisticated CI/CD pipelines for AI-assisted development, where each step has clearly defined inputs, outputs, and responsibilities."}),"\n",(0,t.jsxs)(n.p,{children:["Two notable ingredients of recipes are ",(0,t.jsx)(n.code,{children:"instructions"})," and ",(0,t.jsx)(n.code,{children:"prompt"}),". In short:"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Instructions get added to the system prompt and defines the agent\u2019s roles and capabilities (influences the AI's behavior and personality)"}),"\n",(0,t.jsx)(n.li,{children:"The prompt becomes the initial user message with a specific task (starts the conversation)"}),"\n"]}),"\n",(0,t.jsxs)(i,{children:[(0,t.jsx)("summary",{children:(0,t.jsxs)(n.p,{children:["Snippet from ",(0,t.jsx)(n.code,{children:"workflow_setup"})," showing the difference"]})}),(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:'instructions: |\n  Create a Panther detection rule that detects: {{ rule_description }}\n\n  Use the following context:\n  - Similar rules found: {{ similar_rules_found }}\n  - Rule analysis: {{ rule_analysis }}\n  - Log schemas: {{ log_schemas }}\n  - Standards summary: {{ standards_summary }}\n\n  **SCOPE BOUNDARIES:**\n  - ...\n\nprompt: |\n  ## Process:\n\n  1. **Rule Planning**:\n     - Follow "\ud83d\udcdd Create Rule Files" guidance from `AGENTS.md`\n     - Use streaming rule type (default) unless otherwise specified\n     - Choose appropriate log source and severity level\n  2. **File Creation**:\n     - ...\n  ...\n  5. **Test Cases**:\n     - ...\n  ...\n  7. **\ud83d\uded1 STOP CONDITION**:\n      - ...\n\n  ## \u2705 SUCCESS CRITERIA:\n      - ...\n'})})]}),"\n",(0,t.jsx)(n.p,{children:"The detection creation recipe demonstrates the power of this approach by coordinating six specialized sub-recipes, each handling a specific aspect of detection development:"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.a,{href:"#1-workflow_setup-foundation-first",children:(0,t.jsx)(n.strong,{children:"workflow_setup"})})," - Repository preparation and environment validation"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.a,{href:"#2-similar_rule_analyzer-learning-from-existing-patterns",children:(0,t.jsx)(n.strong,{children:"similar_rule_analyzer"})})," - Finding and analyzing existing detection patterns"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.a,{href:"#3-schema_and_sample_events_analyzer-data-driven-detection-logic",children:(0,t.jsx)(n.strong,{children:"schema_and_sample_events_analyzer"})})," - Analyzing log schemas and performing sample data collection"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.a,{href:"#4-rule_creator-the-implementation-engine",children:(0,t.jsx)(n.strong,{children:"rule_creator"})})," - Actual detection rule implementation"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.a,{href:"#5-testing_validator-quality-assurance",children:(0,t.jsx)(n.strong,{children:"testing_validator"})})," - Comprehensive test execution and validation"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.a,{href:"#6-pr_creator-automated-pull-request-pipeline",children:(0,t.jsx)(n.strong,{children:"pr_creator"})})," - Pull request creation with proper formatting"]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"what-about-goosehints",children:"What about .goosehints?"}),"\n",(0,t.jsxs)(n.p,{children:["In our ",(0,t.jsx)(n.a,{href:"https://block.github.io/goose/blog/2025/06/02/goose-panther-mcp",children:"previous post"}),", we discussed using ",(0,t.jsx)(n.a,{href:"https://block.github.io/goose/docs/guides/using-goosehints/",children:".goosehints"})," to provide persistent context to the Large Language Model (LLM). We continue to use ",(0,t.jsx)(n.code,{children:".goosehints"})," to define coding standards and universal preferences that guide LLM behavior."]}),"\n",(0,t.jsxs)(n.p,{children:["However, to minimize redundancy and avoid conflicting guidance, we adopted a single reference file, ",(0,t.jsx)(n.code,{children:"AGENTS.md"}),", as the source of truth for all agents. Each agent is directed to consult this file, while still supporting agent-specific instructions through their default context files (e.g. ",(0,t.jsx)(n.code,{children:".goosehints"}),", ",(0,t.jsx)(n.code,{children:"CLAUDE.md"})," etc.) or rules (e.g. ",(0,t.jsx)(n.code,{children:".cursor/rules/"}),")."]}),"\n",(0,t.jsx)(n.p,{children:"While these context files are important, they also come with some trade offs and limitations:"}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"Aspect"}),(0,t.jsx)(n.th,{children:"Context Files"}),(0,t.jsx)(n.th,{children:"Recipes"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.strong,{children:"Context window pollution"})}),(0,t.jsx)(n.td,{children:"The entire file is sent with each request, cluttering the context window"}),(0,t.jsx)(n.td,{children:"Only task-relevant instructions, keeping prompts clear and focused"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.strong,{children:"Signal-to-noise ratio"})}),(0,t.jsx)(n.td,{children:"General preferences dilute focus and may create conflicting guidance"}),(0,t.jsx)(n.td,{children:"Every instruction is workflow-specific, eliminating noise"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.strong,{children:"Cost and performance impact"})}),(0,t.jsx)(n.td,{children:"May lead to higher token costs and slower processing from unnecessary context"}),(0,t.jsx)(n.td,{children:"Pay only for relevant tokens with faster response times"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.strong,{children:"Cognitive load on the AI"})}),(0,t.jsx)(n.td,{children:"Conflicting instructions cause decision paralysis"}),(0,t.jsx)(n.td,{children:"Clear, unified guidance enables decisive action"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.strong,{children:"Task-specific optimization"})}),(0,t.jsx)(n.td,{children:"Generic instructions lack specialized tools and parameters"}),(0,t.jsx)(n.td,{children:"Purpose-built with pre-configured tools for specific workflows"})]})]})]}),"\n",(0,t.jsxs)(n.p,{children:["This centralized approach through ",(0,t.jsx)(n.code,{children:"AGENTS.md"})," becomes the foundation for our recipe architecture, which we'll explore next."]}),"\n",(0,t.jsx)(n.h2,{id:"the-architecture",children:"The Architecture"}),"\n",(0,t.jsx)(n.h3,{id:"design-principles",children:"Design Principles"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Single Responsibility"}),": Each sub-recipe has one clear job"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Explicit Data Flow"}),": No hidden state or implicit dependencies"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Fail-Fast"}),": Stop immediately when critical steps fail"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Graceful Degradation"}),": Continue with reduced functionality when possible"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Comprehensive Testing"}),": Validate everything before deployment"]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"why-sub-recipes-matter",children:"Why Sub-Recipes Matter"}),"\n",(0,t.jsx)(n.p,{children:"The traditional approach to AI-assisted detection creation often involves a single, monolithic prompt (AKA \u201csingle-shot prompting\u201d) that tries to handle everything at once. This leads to several problems:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Context confusion"}),": The AI loses focus when juggling multiple responsibilities"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Inconsistent outputs"}),": Without clear boundaries, results vary significantly (e.g. one sub-recipe may try to complete the task that we're expecting another sub-recipe to accomplish)"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Difficult debugging"}),": When something fails, it's hard to identify the specific issue"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Poor maintainability"}),": Changes to one aspect affect the entire workflow"]}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"The sub-recipe architecture solves these problems through strict separation of concerns, setting boundaries and providing exit criteria."}),"\n",(0,t.jsx)(n.p,{children:"Each sub-recipe operates in isolation with:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Clearly defined inputs and outputs"}),"\n",(0,t.jsx)(n.li,{children:"Specific scope boundaries (what it MUST and MUST NOT do)"}),"\n",(0,t.jsx)(n.li,{children:"Standardized JSON response schemas"}),"\n",(0,t.jsx)(n.li,{children:"Formal error handling patterns"}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"At a high level, a (non-parallel) version would look like:"}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"Step"}),(0,t.jsx)(n.th,{children:"Component"}),(0,t.jsx)(n.th,{children:"Type"}),(0,t.jsx)(n.th,{children:"Description"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.strong,{children:"1"})}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.a,{href:"#1-workflow_setup-foundation-first",children:(0,t.jsx)(n.code,{children:"workflow_setup"})})}),(0,t.jsx)(n.td,{children:"Required"}),(0,t.jsx)(n.td,{children:"Initialize workflow environment"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.strong,{children:"2"})}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.a,{href:"#2-similar_rule_analyzer-learning-from-existing-patterns",children:(0,t.jsx)(n.code,{children:"similar_rule_analyzer"})})}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.em,{children:"Conditional"})}),(0,t.jsx)(n.td,{children:"Analyze existing similar rules"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.strong,{children:"3"})}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.a,{href:"#3-schema_and_sample_events_analyzer-data-driven-detection-logic",children:(0,t.jsx)(n.code,{children:"schema_and_sample_events_analyzer"})})}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.em,{children:"Conditional"})}),(0,t.jsx)(n.td,{children:"Process schema and sample data"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.strong,{children:"4"})}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.a,{href:"#4-rule_creator-the-implementation-engine",children:(0,t.jsx)(n.code,{children:"rule_creator"})})}),(0,t.jsx)(n.td,{children:"Required"}),(0,t.jsx)(n.td,{children:"Generate the detection rule"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.strong,{children:"5"})}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.a,{href:"#5-testing_validator-quality-assurance",children:(0,t.jsx)(n.code,{children:"testing_validator"})})}),(0,t.jsx)(n.td,{children:"Required"}),(0,t.jsx)(n.td,{children:"Validate and test the rule"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.strong,{children:"6"})}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.a,{href:"#6-pr_creator-automated-pull-request-pipeline",children:(0,t.jsx)(n.code,{children:"pr_creator"})})}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.em,{children:"Conditional"})}),(0,t.jsx)(n.td,{children:"Create pull request"})]})]})]}),"\n",(0,t.jsxs)(n.blockquote,{children:["\n",(0,t.jsxs)(n.p,{children:["\ud83d\udca1 ",(0,t.jsx)(n.strong,{children:"Note:"})," ",(0,t.jsx)(n.em,{children:"Conditional"})," steps may be skipped based on workflow configuration"]}),"\n"]}),"\n",(0,t.jsxs)(i,{children:[(0,t.jsx)("summary",{children:(0,t.jsx)(n.p,{children:"Workflow visualized"})}),(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{alt:"workflow_diagram",src:s(34941).A+"",width:"507",height:"1294"})})]}),"\n",(0,t.jsx)(n.h2,{id:"data-flow-and-state-management",children:"Data Flow and State Management"}),"\n",(0,t.jsx)(n.p,{children:"Since sub-recipes currently run in isolation, data must be explicitly passed between them. The main recipe orchestrates this flow:"}),"\n",(0,t.jsx)(n.p,{children:"Example of how this would be defined in the recipe:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"`workflow_setup(rule_description)` \u2192 Returns:\n  - **branch_name**: Name of the created feature branch\n  - **standards_summary**: Key standards and requirements from `AGENTS.md`\n  - **repo_ready**: Boolean indicating if repository is ready for development\n  - **mcp_panther**: Object containing Panther MCP access test results\n    - **access_test_successful**: Boolean indicating if Panther MCP access test was successful\n    - **error_message**: Error message if access test failed\n"})}),"\n",(0,t.jsx)(n.p,{children:"And an example of how the data would flow:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:'workflow_setup(rule_description) \u2192 {\n  branch_name: "ai/aws-privilege-escalation",\n  standards_summary: "Key requirements from AGENTS.md...",\n  repo_ready: true,\n  mcp_panther: { access_test_successful: true }\n}\n\nsimilar_rule_analyzer(rule_description, standards_summary) \u2192 {\n  similar_rules_found: [...],\n  rule_analysis: "Analysis of existing patterns...",\n  suggested_approach: "Create new rule with modifications..."\n}\n'})}),"\n",(0,t.jsx)(n.p,{children:"This explicit data passing ensures:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Predictable behavior"})," across runs"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Easy debugging"})," when issues occur"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Clear audit trails"})," of what data influenced each decision"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Modular testing"})," of individual components"]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"smart-optimizations-conditional-execution",children:"Smart Optimizations: Conditional Execution"}),"\n",(0,t.jsx)(n.p,{children:"One of the most powerful features of the detection creation workflow is its intelligent optimization system that skips unnecessary steps based on both parameters and runtime conditions."}),"\n",(0,t.jsx)(n.h3,{id:"parameter-based-conditions",children:"Parameter-Based Conditions"}),"\n",(0,t.jsx)(n.p,{children:"Users can control workflow behavior through parameters:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-shell",children:'# Fast mode - skip similar rule analysis\ngoose run --recipe recipe.yaml --params skip_similar_rules_check=true --rule_description="What you want to detect"\n\n# Skip Panther MCP integration\ngoose run --recipe recipe.yaml --params skip_panther_mcp=true --rule_description="What you want to detect"\n\n# Create PR automatically\ngoose run --recipe recipe.yaml --params create_pr=true --rule_description="What you want to detect"\n'})}),"\n",(0,t.jsx)(n.h3,{id:"runtime-conditions",children:"Runtime Conditions"}),"\n",(0,t.jsx)(n.p,{children:"The workflow makes intelligent decisions based on results from previous steps:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"# Current implementation uses both parameter-based and runtime conditions\n# Parameter-based (available at recipe start):\n- skip_similar_rules_check: Controls similar_rule_analyzer execution\n- skip_panther_mcp: Controls schema_and_sample_events_analyzer execution  \n- create_pr: Controls pr_creator execution\n\n# Runtime conditions (based on sub-recipe results):\n- schema_and_sample_events_analyzer runs only if:\n  * skip_panther_mcp is false AND\n  * (similar_rules_found is empty OR mcp_panther.access_test_successful is false)\n"})}),"\n",(0,t.jsx)(n.p,{children:"This hybrid approach provides:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Efficiency"}),": Avoid redundant API calls when similar rules provide sufficient context"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Reliability"}),": Graceful degradation when external services are unavailable"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Flexibility"}),": Users can choose their preferred speed vs. thoroughness trade-off"]}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"Additionally, Jinja support enables the codification of event triggers, ensuring the agent adheres to predefined instructions rather than making independent, potentially incorrect, decisions. For instance, the agent can be directed to bypass a step, depending on a parameter's value:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:'{% if create_pr %}\n6. `pr_creator(rule_files_created, rule_description, branch_name, create_pr={{ create_pr }}, panther_mcp_usage)` \u2192 Returns:\n    {\n      "success": true,\n      "data": {\n        "pr_created": true,\n        "pr_url": "https://github.com/<org>/<team>-panther-content/pull/123",\n        "pr_number": 123,\n        "summary": "Summary of the completed work"\n      }\n    }\n{% else %}\n6. **SKIPPED** `pr_creator` - create_pr parameter is false\n    - Provide final summary of completed work instead\n{% endif %}\n'})}),"\n",(0,t.jsx)(n.h2,{id:"deep-dive-key-sub-recipes",children:"Deep Dive: Key Sub-Recipes"}),"\n",(0,t.jsxs)(n.h3,{id:"1-workflow_setup-foundation-first",children:["1. ",(0,t.jsx)(n.code,{children:"workflow_setup"}),": Foundation First"]}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"Input"}),(0,t.jsx)(n.th,{children:"Output"})]})}),(0,t.jsx)(n.tbody,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"rule_description"})}),(0,t.jsxs)(n.td,{children:[(0,t.jsx)(n.code,{children:"branch_name"}),", ",(0,t.jsx)(n.code,{children:"standards_summary"}),", ",(0,t.jsx)(n.code,{children:"repo_ready"}),", ",(0,t.jsx)(n.code,{children:"mcp_panther"})]})]})})]}),"\n",(0,t.jsx)(n.p,{children:"This sub-recipe handles all the foundational work:"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Key responsibilities"}),":"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Repository access verification"}),"\n",(0,t.jsx)(n.li,{children:"Git branch creation and management"}),"\n",(0,t.jsxs)(n.li,{children:["Standards extraction from ",(0,t.jsx)(n.code,{children:"AGENTS.md"})]}),"\n",(0,t.jsx)(n.li,{children:"Environment validation"}),"\n",(0,t.jsx)(n.li,{children:"Panther MCP access testing"}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Output example"}),":"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-json",children:'{\n  "status": { "success": true },\n  "data": {\n    "branch_name": "ai/okta-suspicious-login",\n    "standards_summary": "Rules must use ai_ prefix, implement required functions...",\n    "repo_ready": true,\n    "mcp_panther": { "access_test_successful": true }\n  }\n}\n'})}),"\n",(0,t.jsxs)(n.h3,{id:"2-similar_rule_analyzer-learning-from-existing-patterns",children:["2. ",(0,t.jsx)(n.code,{children:"similar_rule_analyzer"}),": Learning from Existing Patterns"]}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"Input"}),(0,t.jsx)(n.th,{children:"Output"})]})}),(0,t.jsx)(n.tbody,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsxs)(n.td,{children:[(0,t.jsx)(n.code,{children:"rule_description"}),", ",(0,t.jsx)(n.code,{children:"standards_summary"}),", ",(0,t.jsx)(n.code,{children:"rule_type"})]}),(0,t.jsxs)(n.td,{children:[(0,t.jsx)(n.code,{children:"similar_rules_found"}),", ",(0,t.jsx)(n.code,{children:"rule_analysis"}),", ",(0,t.jsx)(n.code,{children:"suggested_approach"})]})]})})]}),"\n",(0,t.jsx)(n.p,{children:"This sub-recipe searches the repository for similar detection patterns:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"# Search strategy by rule type:\n- streaming rules: Search rules/<team>_rules/\n- correlation rules: Search correlation_rules/<team>_correlation_rules/  \n- scheduled rules: Search queries/<team>_queries/\n"})}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Key responsibilities"}),":"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Search for existing rules with similar log sources and detection logic"}),"\n",(0,t.jsx)(n.li,{children:"Prioritize team-created rules over upstream patterns"}),"\n",(0,t.jsx)(n.li,{children:"Analyze implementation approaches and coding patterns"}),"\n",(0,t.jsx)(n.li,{children:"Provide recommendations for new rule development"}),"\n",(0,t.jsx)(n.li,{children:"Extract relevant context from similar implementations"}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Key insight"}),": It prioritizes team-created rules (<team>_* directories) over upstream rules, ensuring consistency with established patterns."]}),"\n",(0,t.jsx)(n.p,{children:"Even without direct access to the detection engine, users can develop new detections by leveraging existing ones, along with our established standards and test suite."}),"\n",(0,t.jsxs)(n.h3,{id:"3-schema_and_sample_events_analyzer-data-driven-detection-logic",children:["3. ",(0,t.jsx)(n.code,{children:"schema_and_sample_events_analyzer"}),": Data-Driven Detection Logic"]}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"Input"}),(0,t.jsx)(n.th,{children:"Output"})]})}),(0,t.jsx)(n.tbody,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsxs)(n.td,{children:[(0,t.jsx)(n.code,{children:"rule_description"}),", ",(0,t.jsx)(n.code,{children:"similar_rules_found"})]}),(0,t.jsxs)(n.td,{children:[(0,t.jsx)(n.code,{children:"log_schemas"}),", ",(0,t.jsx)(n.code,{children:"example_logs"}),", ",(0,t.jsx)(n.code,{children:"field_mapping"}),", ",(0,t.jsx)(n.code,{children:"panther_mcp_usage"})]})]})})]}),"\n",(0,t.jsx)(n.p,{children:"This sub-recipe bridges the gap between detection requirements and implementation by leveraging Panther's MCP integration:"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Key responsibilities"}),":"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Log schema analysis using Panther MCP"}),"\n",(0,t.jsx)(n.li,{children:"Sample event collection from data lakes"}),"\n",(0,t.jsx)(n.li,{children:"Field mapping for detection logic"}),"\n",(0,t.jsx)(n.li,{children:"Snowflake SQL query optimization"}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Smart data collection strategy"}),":"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.em,{children:"Parallel execution"}),": Runs multiple Snowflake queries simultaneously rather than sequentially"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.em,{children:"Query planning"}),": Identifies all needed queries before execution to maximize efficiency"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.em,{children:"Progressive sampling"}),": Starts with small result sets (LIMIT 5), scales up as needed"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.em,{children:"Critical boundaries"}),": It explicitly cannot create rule files or run tests - its sole focus is understanding the data structure."]}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Output example"}),":"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-json",children:'{\n  "status": { "success": true },\n  "data": {\n    "log_schemas": [{\n      "log_type": "AWS.CloudTrail",\n      "schema_summary": "Contains eventName, sourceIPAddress, userIdentity fields",\n      "relevance": "Essential for detecting privilege escalation patterns"\n    }],\n    "example_logs": [{\n      "log_type": "AWS.CloudTrail", \n      "event_summary": "AssumeRole events with cross-account access",\n      "key_fields": ["eventName", "sourceIPAddress", "userIdentity.type"]\n    }],\n    "panther_mcp_usage": {\n      "mcp_used": true,\n      "log_schemas_referenced": true,\n      "data_lake_queries_performed": true\n    }\n  }\n}\n'})}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.em,{children:"Fallback handling"}),": When Panther MCP is unavailable, it intelligently uses similar rule analysis to infer schema structure, ensuring the workflow continues with reduced but functional capability."]}),"\n",(0,t.jsxs)(n.h3,{id:"4-rule_creator-the-implementation-engine",children:["4. ",(0,t.jsx)(n.code,{children:"rule_creator"}),": The Implementation Engine"]}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"Input"}),(0,t.jsx)(n.th,{children:"Output"})]})}),(0,t.jsx)(n.tbody,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsxs)(n.td,{children:[(0,t.jsx)(n.code,{children:"rule_description"}),", ",(0,t.jsx)(n.code,{children:"similar_rules_found"}),", ",(0,t.jsx)(n.code,{children:"rule_analysis"}),", ",(0,t.jsx)(n.code,{children:"log_schemas"}),", ",(0,t.jsx)(n.code,{children:"standards_summary"})]}),(0,t.jsxs)(n.td,{children:[(0,t.jsx)(n.code,{children:"rule_files_created"}),", ",(0,t.jsx)(n.code,{children:"rule_implementation"}),", ",(0,t.jsx)(n.code,{children:"test_cases_created"})]})]})})]}),"\n",(0,t.jsx)(n.p,{children:"This is where the magic happens - this sub-recipe generates the required files containing the detection logic, metadata and unit tests."}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Smart log source validation"}),":"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"If schema analysis ran successfully \u2192 Use validated log types"}),"\n",(0,t.jsx)(n.li,{children:"If schema analysis was skipped \u2192 Validate against known log types defined in pytests."}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Example key principles"}),":"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Always use default values for event fields"}),"\n",(0,t.jsx)(n.li,{children:"Use case-insensitive matching for user-controlled fields"}),"\n",(0,t.jsx)(n.li,{children:"Structure logic clearly with grouped conditions"}),"\n",(0,t.jsxs)(n.li,{children:["Prefer ",(0,t.jsx)(n.code,{children:"any()"})," and ",(0,t.jsx)(n.code,{children:"all()"})," over multiple return statements"]}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"To illustrate, the following example provides guidance for the last bullet point:"}),"\n",(0,t.jsxs)(n.blockquote,{children:["\n",(0,t.jsxs)(n.p,{children:["\ud83d\udca1 ",(0,t.jsx)(n.strong,{children:"Code Quality Tip: Simplify Conditional Logic"})]}),"\n",(0,t.jsx)(n.p,{children:"\u274c Avoid: Too Many Return Statements"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-python",children:'# multiple returns make logic hard to follow\ndef rule(event) -> bool:\n if event.deep_get("eventType", default="") != "user.session.start":\n   return False\n \n if event.deep_get("outcome", "result", default="") != "SUCCESS":\n   return False \n\n if event.deep_get("actor", "alternateId", default="").lower() == TARGET_USER.lower():\n   return True\n\n return False\n'})}),"\n",(0,t.jsxs)(n.p,{children:["\u2705 Preferred: Clear Structure with ",(0,t.jsx)(n.code,{children:"any()"})," and ",(0,t.jsx)(n.code,{children:"all()"})]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-python",children:'def rule(event) -> bool:\n  return all([\n    event.deep_get("eventType", default="") == "user.session.start",\n    event.deep_get("outcome", "result", default="") == "SUCCESS",\n    event.deep_get("actor", "alternateId", default="").lower() == TARGET_USER.lower()\n  ])\n'})}),"\n"]}),"\n",(0,t.jsxs)(n.h3,{id:"5-testing_validator-quality-assurance",children:["5. ",(0,t.jsx)(n.code,{children:"testing_validator"}),": Quality Assurance"]}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"Input"}),(0,t.jsx)(n.th,{children:"Output"})]})}),(0,t.jsx)(n.tbody,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"rule_files_created"})}),(0,t.jsxs)(n.td,{children:[(0,t.jsx)(n.code,{children:"test_results"}),", ",(0,t.jsx)(n.code,{children:"validation_status"}),", ",(0,t.jsx)(n.code,{children:"issues_found"})]})]})})]}),"\n",(0,t.jsx)(n.p,{children:"This sub-recipe serves as the critical quality gate, executing the mandatory testing pipeline that ensures every detection meets production standards."}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Key responsibilities"}),":"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Execute all mandatory testing commands from ",(0,t.jsx)(n.code,{children:"AGENTS.md"})," (e.g. linting, formatting and both unit and pytests)"]}),"\n",(0,t.jsx)(n.li,{children:"Validate rule implementation against team standards"}),"\n",(0,t.jsx)(n.li,{children:"Provide actionable feedback for fixing issues"}),"\n",(0,t.jsx)(n.li,{children:"Ensure compliance with security and coding requirements"}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"These checks ensure detections meet our standards, preventing subpar code from being merged. Should a check fail, the LLM will iterate, identifying and implementing necessary changes until compliance is achieved as part of the same recipe run."}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Intelligent failure analysis"}),": The sub-recipe doesn't just run tests - it analyzes failures and provides specific guidance:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-json",children:'{\n  "test_results": {\n    "tests_passed": 3,\n    "tests_failed": 1,\n    "test_details": [{\n      "test_name": "make lint",\n      "status": "failed", \n      "message": "pylint: missing default value in deep_get() call"\n    }]\n  },\n  "recommendations": [\n    "Add default values to all deep_get() calls per AGENTS.md standards",\n    "Reference \'Core Coding Standards\' section for proper error handling"\n  ]\n}\n'})}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Output example"}),":"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-json",children:'{\n  "status": { "success": true },\n  "data": {\n    "test_results": {\n      "tests_passed": 4,\n      "tests_failed": 0,\n      "test_details": [\n        { "test_name": "make fmt", "status": "passed", "message": "All files formatted correctly" },\n        { "test_name": "make lint", "status": "passed", "message": "No linting issues found" },\n        { "test_name": "make test", "status": "passed", "message": "Rule tests passed: 2/2" },\n        { "test_name": "make pytest-all", "status": "passed", "message": "All unit tests passed" }\n      ]\n    },\n    "validation_summary": "All mandatory tests passed. Rule ready for PR creation.",\n    "recommendations": []\n  }\n}\n'})}),"\n",(0,t.jsxs)(n.h3,{id:"6-pr_creator-automated-pull-request-pipeline",children:["6. ",(0,t.jsx)(n.code,{children:"pr_creator"}),": Automated Pull Request Pipeline"]}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"Input"}),(0,t.jsx)(n.th,{children:"Output"})]})}),(0,t.jsx)(n.tbody,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsxs)(n.td,{children:[(0,t.jsx)(n.code,{children:"rule_files_created"}),", ",(0,t.jsx)(n.code,{children:"rule_description"}),", ",(0,t.jsx)(n.code,{children:"branch_name"}),", ",(0,t.jsx)(n.code,{children:"create_pr"}),", ",(0,t.jsx)(n.code,{children:"panther_mcp_usage"})]}),(0,t.jsxs)(n.td,{children:[(0,t.jsx)(n.code,{children:"pr_created"}),", ",(0,t.jsx)(n.code,{children:"pr_url"}),", ",(0,t.jsx)(n.code,{children:"pr_number"}),", ",(0,t.jsx)(n.code,{children:"summary"})]})]})})]}),"\n",(0,t.jsx)(n.p,{children:"This sub-recipe handles the final workflow step with full adherence to team standards:"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Key responsibilities"}),":"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Git branch management and commits"}),"\n",(0,t.jsx)(n.li,{children:"PR template population with proper formatting"}),"\n",(0,t.jsx)(n.li,{children:"Panther MCP usage tracking and reporting"}),"\n",(0,t.jsx)(n.li,{children:"Draft PR creation for team review"}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Intelligent PR creation"}),":"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.em,{children:"Conditional execution"}),": Only creates PRs when ",(0,t.jsx)(n.code,{children:"create_pr=true"}),", otherwise provides summary"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.em,{children:"Template compliance"}),": Automatically populates PR templates from ",(0,t.jsx)(n.code,{children:"AGENTS.md"})," standards"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.em,{children:"MCP usage reporting"}),": Documents whether Panther MCP was used in the workflow section (which is useful for PR reviewers to know)"]}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Git operation standards"}),":"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Never uses ",(0,t.jsx)(n.code,{children:"--no-verify"})," flags - fixes issues rather than bypassing them"]}),"\n",(0,t.jsx)(n.li,{children:"Follows commit message guidelines from team standards"}),"\n",(0,t.jsx)(n.li,{children:"Ensures proper branch management and remote synchronization"}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Output example"}),":"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-json",children:'{\n  "status": { "success": true },\n  "data": {\n    "pr_url": "https://github.com/<org>/<team>-panther-content/pull/123",\n    "pr_number": 123,\n    "branch_name": "ai/aws-privilege-escalation",\n    "commit_hash": "abc123def",\n    "files_committed": ["rules/<team>_rules/ai_aws_privilege_escalation.py", "rules/<team>_rules/ai_aws_privilege_escalation.yml"]\n  }\n}\n'})}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.em,{children:"Quality assurance"}),": This sub-recipe includes comprehensive error handling for git failures, PR creation issues, and template population problems, providing clear fallback instructions when automation fails."]}),"\n",(0,t.jsx)(n.h2,{id:"error-handling-and-fail-fast-design",children:"Error Handling and Fail-Fast Design"}),"\n",(0,t.jsx)(n.p,{children:"This workflow implements sophisticated error handling with intelligent stopping points:"}),"\n",(0,t.jsx)(n.h3,{id:"standardized-response-schema",children:"Standardized Response Schema"}),"\n",(0,t.jsx)(n.p,{children:"Every sub-recipe uses a consistent JSON response format:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-json",children:'{\n  "status": {\n    "success": boolean,\n    "error": "Error message if failed",\n    "error_type": "categorized_error_type"\n  },\n  "data": { /* Actual response data */ },\n  "partial_results": { /* Optional partial data */ }\n}\n'})}),"\n",(0,t.jsx)(n.h3,{id:"failures",children:"Failures"}),"\n",(0,t.jsxs)(n.p,{children:["This workflow distinguishes between different types of failures. For example, each sub-recipe\u2019s response has an ",(0,t.jsx)(n.code,{children:"error_code"})," field. When a failure occurs, the LLM categorizes the type of error encountered and surfaces this information to the main recipe so it can make a determination on what to do next."]}),"\n",(0,t.jsxs)(n.p,{children:["As an example, ",(0,t.jsx)(n.code,{children:"rule_creator"})," is configured with these error categories:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:'response:\n  json_schema:\n    type: object\n    properties:\n      status:\n        type: object\n        properties:\n          ...\n          error_type:\n            type: string\n            enum: ["git_operation_failed", "pr_creation_failed", "template_population_failed", "validation_failed"]\n            description: "Category of error for debugging purposes"\n        ...\n'})}),"\n",(0,t.jsxs)(n.p,{children:["If this sub-recipe returns ",(0,t.jsx)(n.code,{children:"file_creation_failed"}),", we shouldn\u2019t move on to the ",(0,t.jsx)(n.code,{children:"testing_validator"})," or ",(0,t.jsx)(n.code,{children:"pr_creator"})," steps."]}),"\n",(0,t.jsx)(n.p,{children:"This fail-fast approach prevents wasted effort on meaningless subsequent steps."}),"\n",(0,t.jsx)(n.h2,{id:"practical-usage-examples",children:"Practical Usage Examples"}),"\n",(0,t.jsx)(n.h3,{id:"basic-usage-fast-detection-creation",children:"Basic Usage: Fast Detection Creation"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-shell",children:'# Create a detection without creating a PR or similar rule/Panther MCP analysis\ngoose run --recipe recipe.yaml \\\n  --params skip_similar_rules_check=true \\\n  --params skip_panther_mcp=true \\\n  --params rule_description="Create an AWS CloudTrail detection to identify new regions being enabled without any associated errorCodes"\n'})}),"\n",(0,t.jsx)(n.h3,{id:"comprehensive-analysis-mode",children:"Comprehensive Analysis Mode"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-shell",children:'# Full workflow with schema/event sampling and automatic PR creation\ngoose run --recipe recipe.yaml --interactive \\\n  --params skip_similar_rules_check=true \\\n  --params skip_panther_mcp=false \\\n  --params create_pr=true \\\n  --params rule_description="Create a Panther rule that will detect when the user fbar@block.xyz successfully logs in to Okta from a Windows system"\n'})}),"\n",(0,t.jsx)(n.h2,{id:"standards-compliance-and-quality-assurance",children:"Standards Compliance and Quality Assurance"}),"\n",(0,t.jsx)(n.p,{children:"The recipe system ensures compliance with team standards through:"}),"\n",(0,t.jsx)(n.h3,{id:"automated-standards-extraction",children:"Automated Standards Extraction"}),"\n",(0,t.jsxs)(n.p,{children:["The ",(0,t.jsx)(n.code,{children:"workflow_setup"})," sub-recipe extracts key requirements from ",(0,t.jsx)(n.code,{children:"AGENTS.md"}),":"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["File naming conventions (",(0,t.jsx)(n.code,{children:"ai_"})," prefix for AI-created rules)"]}),"\n",(0,t.jsx)(n.li,{children:"Required Python functions and error handling patterns"}),"\n",(0,t.jsx)(n.li,{children:"Testing requirements and validation commands"}),"\n",(0,t.jsx)(n.li,{children:"PR creation standards and templates"}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"built-in-quality-checks",children:"Built-in Quality Checks"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Code formatting"}),": Automatic formatting execution"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Linting"}),": Comprehensive linting validation"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Testing"}),": Mandatory test suite execution"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Security"}),": No PII in test cases (based on LLM's determination) and proper error handling (e.g. ensuring default values are returned)"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Consistency"}),": Standardized file structures and naming"]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"pull-request-automation",children:"Pull Request Automation"}),"\n",(0,t.jsxs)(n.p,{children:["The ",(0,t.jsx)(n.code,{children:"pr_creator"})," sub-recipe follows team standards:"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Proper branch naming (e.g. ",(0,t.jsx)(n.code,{children:"ai/<description>"}),")"]}),"\n",(0,t.jsx)(n.li,{children:"Template-based PR descriptions"}),"\n",(0,t.jsx)(n.li,{children:"Draft mode for review"}),"\n",(0,t.jsx)(n.li,{children:"Comprehensive change summaries"}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"panther-mcp-integration",children:"Panther MCP Integration"}),"\n",(0,t.jsxs)(n.p,{children:["The workflow integrates with ",(0,t.jsx)(n.a,{href:"https://github.com/panther-labs/mcp-panther",children:"Panther's Model Context Protocol"})," (MCP) for:"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Schema analysis"}),": Understanding log structure and available fields"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Sample data collection"}),": Gathering realistic test data from data lakes"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Field mapping"}),": Identifying key fields for detection logic"]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"benefits-and-impact",children:"Benefits and Impact"}),"\n",(0,t.jsx)(n.p,{children:"For Security Teams"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Faster detection development"}),": Minutes instead of hours"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Consistent quality"}),": Automated adherence to standards"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Reduced errors"}),": Comprehensive testing before deployment"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Knowledge sharing"}),": Similar rule analysis spreads best practices"]}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"For AI Development"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Modular architecture"}),": Easy to modify individual components"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Clear debugging"}),": Specific failure points and error categories"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Predictable behavior"}),": Consistent outputs across runs"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Maintainable code"}),": Well-defined boundaries and responsibilities"]}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"For Organizations"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Accessibility"}),": Empowers users to create detections without deep knowledge of the underlying detection engine"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Scalable security"}),": Rapid response to new threats"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Quality assurance"}),": Built-in testing and validation"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Documentation"}),": Automatic PR creation with proper context"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Compliance"}),": Adherence to security and development standards"]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"conclusion",children:"Conclusion"}),"\n",(0,t.jsx)(n.p,{children:"Goose's recipe and sub-recipe system represents a significant advancement in AI-assisted security detection development. By breaking complex workflows into specialized, composable components, teams can achieve:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Higher quality detections"})," through automated testing and validation"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Faster development cycles"})," with intelligent optimization"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Better consistency"})," through standardized processes"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Easier maintenance"})," with modular, well-defined components"]}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"The detection creation recipe demonstrates how thoughtful architecture and clear separation of concerns can transform a complex, error-prone manual process into a reliable, automated workflow."}),"\n",(0,t.jsx)(n.p,{children:"Whether you're building your first Goose recipe or looking to optimize existing workflows, the patterns and principles outlined here provide a solid foundation for successful automation."}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"best-practices-and-lessons-learned",children:"Best Practices and Lessons Learned"}),"\n",(0,t.jsx)(n.h4,{id:"instruction-formatting--clarity",children:"Instruction Formatting & Clarity"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Prefer ",(0,t.jsx)(n.strong,{children:"concise bullet points"})," over dense paragraphs to keep instructions skimmable."]}),"\n",(0,t.jsxs)(n.li,{children:["Use ",(0,t.jsx)(n.strong,{children:"emphasis"})," (e.g. *",(0,t.jsx)(n.em,{children:"bold*"}),", ALL CAPS) to highlight important constraints or behaviors."]}),"\n",(0,t.jsxs)(n.li,{children:["Write ",(0,t.jsx)(n.strong,{children:"task-specific"})," instructions with clear exit criteria \u2014 avoid asking the agent to do more than it needs to."]}),"\n"]}),"\n",(0,t.jsx)(n.h4,{id:"structure--logic-in-prompts",children:"Structure & Logic in Prompts"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Use ",(0,t.jsx)(n.strong,{children:"explicit logic"})," in templating (e.g., Jinja): define yes/no flags rather than relying on the LLM to infer conditions."]}),"\n",(0,t.jsxs)(n.li,{children:["Provide ",(0,t.jsx)(n.strong,{children:"structured output"})," (e.g. JSON) where needed to support downstream recipes or tools."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Avoid vague labels"})," \u2014 use neutral and consistent verbiage (e.g., \u201ccorrect/incorrect\u201d instead of \u201cgood/bad\u201d)."]}),"\n"]}),"\n",(0,t.jsx)(n.h4,{id:"validation--guardrails",children:"Validation & Guardrails"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Add ",(0,t.jsx)(n.strong,{children:"code snippets or examples"})," to illustrate expected behavior."]}),"\n",(0,t.jsxs)(n.li,{children:["Use ",(0,t.jsx)(n.strong,{children:"checklists"})," to help the AI verify whether it followed all required steps."]}),"\n",(0,t.jsxs)(n.li,{children:["Incorporate ",(0,t.jsx)(n.strong,{children:"pytests"})," or other test gates to catch issues early. Avoid bypasses like ",(0,t.jsx)(n.code,{children:"--no-verify"})," on ",(0,t.jsx)(n.code,{children:"git"})," commands.","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Let the system self-correct"})," where possible."]}),"\n",(0,t.jsx)(n.li,{children:"Codify standards so updates are required to pass tests before a PR can be pushed."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.h4,{id:"knowledge-sharing--context-management",children:"Knowledge Sharing & Context Management"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Provide ",(0,t.jsx)(n.strong,{children:"strong examples"})," that the agent can learn from, reducing reliance on querying the data lake."]}),"\n",(0,t.jsxs)(n.li,{children:["Maintain a ",(0,t.jsx)(n.strong,{children:"central reference"})," (e.g. ",(0,t.jsx)(n.code,{children:"AGENTS.md"}),") for all AI agents:","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Users may want to contribute outside of your traditional development workflow"}),"\n",(0,t.jsxs)(n.li,{children:["Link steps or sections in ",(0,t.jsx)(n.code,{children:".goosehints"}),", ",(0,t.jsx)(n.code,{children:"CLAUDE.md"}),", ",(0,t.jsx)(n.code,{children:".cursor/rules/*"}),", etc., back to this file."]}),"\n",(0,t.jsxs)(n.li,{children:["Consider having an agent help structure ",(0,t.jsx)(n.code,{children:"AGENTS.md"})," for easier parsing and reuse across agents."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.h4,{id:"workflow-design",children:"Workflow Design"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Use ",(0,t.jsx)(n.strong,{children:"PR templates and guidelines"})," to standardize formatting and expectations for AI-generated contributions."]}),"\n",(0,t.jsxs)(n.li,{children:["Leverage a ",(0,t.jsx)(n.strong,{children:"shared context across recipes"}),", but isolate workflows using separate context windows where appropriate.","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Allows output passing and ",(0,t.jsx)(n.strong,{children:"parallel execution"}),", while supporting ",(0,t.jsx)(n.strong,{children:"separation of duties"})," between steps."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(l,{children:[(0,t.jsx)("meta",{property:"og:title",content:"Streamlining Detection Development with Goose Recipes"}),(0,t.jsx)("meta",{property:"og:type",content:"article"}),(0,t.jsx)("meta",{property:"og:url",content:"https://block.github.io/goose/blog/2025/07/28/streamlining-detection-development-with-goose-recipes"}),(0,t.jsx)("meta",{property:"og:description",content:"A comprehensive guide to using recipes in Goose to streamline security detection development"}),(0,t.jsx)("meta",{property:"og:image",content:"https://block.github.io/goose/assets/images/goose-recipes-detection-development-cover.png"}),(0,t.jsx)("meta",{property:"og:image",content:"https://block.github.io/goose/assets/images/goose-recipes-detection-development-cover-cac8a9bea2d090ec2758a0b907bc9da8.png"}),(0,t.jsx)("meta",{property:"twitter:domain",content:"block.github.io/goose"}),(0,t.jsx)("meta",{name:"twitter:title",content:"Streamlining Detection Development with Goose Recipes"}),(0,t.jsx)("meta",{name:"twitter:description",content:"A comprehensive guide to using recipes in Goose to streamline security detection development"}),(0,t.jsx)("meta",{name:"twitter:image",content:"https://block.github.io/goose/assets/images/goose-recipes-detection-development-cover.png"}),(0,t.jsx)("meta",{name:"twitter:image",content:"https://block.github.io/goose/assets/images/goose-recipes-detection-development-cover-cac8a9bea2d090ec2758a0b907bc9da8.png"})]})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(c,{...e})}):c(e)}function u(e,n){throw new Error("Expected "+(n?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}},57977:(e,n,s)=>{s.d(n,{A:()=>i});const i=s.p+"assets/images/goose-recipes-detection-development-cover-cac8a9bea2d090ec2758a0b907bc9da8.png"},34941:(e,n,s)=>{s.d(n,{A:()=>i});const i=s.p+"assets/images/workflow_diagram-178659b4e6b593f9bbfe1f09df21fcc2.png"},28453:(e,n,s)=>{s.d(n,{R:()=>l,x:()=>a});var i=s(96540);const t={},r=i.createContext(t);function l(e){const n=i.useContext(r);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:l(e.components),i.createElement(r.Provider,{value:n},e.children)}},36991:e=>{e.exports=JSON.parse('{"permalink":"/goose/blog/2025/07/28/streamlining-detection-development-with-goose-recipes","source":"@site/blog/2025-07-28-streamlining-detection-development-with-goose-recipes/index.md","title":"Streamlining Detection Development with Goose Recipes","description":"A comprehensive guide to using recipes in Goose to streamline security detection development","date":"2025-07-28T00:00:00.000Z","tags":[],"readingTime":17.875,"hasTruncateMarker":true,"authors":[{"name":"Glenn Edwards","title":"Detection Engineer","page":{"permalink":"/goose/blog/authors/glenn"},"socials":{"linkedin":"https://www.linkedin.com/in/glennpedwardsjr/","github":"https://github.com/hiddenillusion","x":"https://x.com/hiddenillusion","bluesky":"https://bsky.app/profile/hiddenillusion"},"imageURL":"https://avatars.githubusercontent.com/u/1418309?v=4","key":"glenn"}],"frontMatter":{"title":"Streamlining Detection Development with Goose Recipes","description":"A comprehensive guide to using recipes in Goose to streamline security detection development","authors":["glenn"]},"unlisted":false,"prevItem":{"title":"When AI Meets AI: Goose Desktop and CLI Collaborate","permalink":"/goose/blog/2025/07/28/ai-to-ai"},"nextItem":{"title":"Orchestrating 6 Subagents to Build a Collaborative API Playground for Kids","permalink":"/goose/blog/2025/07/21/orchestrating-subagents"}}')}}]);